<videotron video-url="$ctrl.Deed.current.videoUrl"></videotron>

<div class="container container-pad">
  <div class="row">
    <div ng-hide="$ctrl.loading || $ctrl.error">
      <div class="col-sm-3 col-sm-push-9 m-b-sm">
        <button type="button"
                class="btn btn-primary btn-block btn-lg"
                ng-click="$ctrl.done($ctrl.Deed.current, $ctrl.User.group)"
                ng-if="$ctrl.User.isAuthenticated()"
                ng-disabled="$ctrl.doing">
          <img src="/images/logo-invert.png" class="img-responsive img-btn" ng-hide="$ctrl.doing">
          <i class="fa fa-cog fa-lg fa-spin" ng-show="$ctrl.doing"></i>
          Done
        </button>
        <button type="button"
                class="btn btn-primary btn-block"
                ng-click="$ctrl.testimony($ctrl.Deed.current, $ctrl.User.group)"
                ng-if="$ctrl.User.isAuthenticated()">
          <i class="fa fa-fw fa-comment"></i>
          Leave a Testimony
        </button>

        <button type="button"
                class="btn btn-primary btn-block btn-lg"
                ng-click="$ctrl.Modal.openLogin()"
                ng-if="!$ctrl.User.isAuthenticated()">
          <i class="fa fa-fw fa-user"></i>
          Login
        </button>
      </div>

      <div class="col-sm-9 col-sm-pull-3">
        <div class="deed-header m-b-md">
          <img src="/images/deed.png" class="img-responsive img-circle pull-left m-t-xxs m-r-sm">
          <h1 class="m-none">
            {{ $ctrl.Deed.current.title }}
          </h1>
          <p class="m-none">
            <span class="f-lg">
              {{ $ctrl.Act.counters[$ctrl.Deed.current._id] | number }}
            </span>
            acts of love
          </p>
        </div>

        <uib-tabset active="$ctrl.activeTab"
                    type="pills">
          <span class="pull-right">
            <button type="button"
                    ng-click="$ctrl.loadFeed($ctrl.Deed.current, { after: $ctrl.feedItems[0].created })"
                    ng-show="$ctrl.activeTab === 1"
                    ng-disabled="$ctrl.loadingFeed || $ctrl.feedItems === null"
                    class="btn btn-link">
              <i class="fa fa-refresh fa-lg"
                 ng-class="{ 'fa-spin': $ctrl.loadingFeed }"></i>
            </button>
          </span>

          <uib-tab>
            <uib-tab-heading>
              <i class="fa fa-fw fa-book"></i>
              Devotional
            </uib-tab-heading>

            <div marked="$ctrl.Deed.current.content"></div>
          </uib-tab>

          <uib-tab>
            <uib-tab-heading>
              <i class="fa fa-fw fa-list"></i>
              Activity Feed
            </uib-tab-heading>

            <feed feed-items="$ctrl.feedItems"
                  loading="$ctrl.loadingFeed"
                  load-more="$ctrl.loadFeed(
                    $ctrl.Deed.current,
                    { before: $ctrl.feedItems[$ctrl.feedItems.length - 1].created }
                  )"
                  ng-hide="$ctrl.feedItems === null"></feed>

            <p class="text-center"
               ng-show="$ctrl.feedItems === null">
              <i class="fa fa-cog fa-5x fa-spin"></i>
            </p>
          </uib-tab>
        </uib-tabset>
      </div>
    </div>

    <div class="col-xs-12" ng-show="$ctrl.loading">
      <p class="text-center">
        <i class="fa fa-cog fa-5x fa-spin"></i>
      </p>
    </div>

    <div class="col-xs-12" ng-show="$ctrl.error">
      <uib-alert type="danger">
        <i class="fa fa-exclamation-triangle"></i>
        {{ $ctrl.error }}
      </uib-alert>
    </div>
  </div>
</div>
