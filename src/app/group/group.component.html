<liow-jumbotron
  image="/images/group.png"
  [background]="(group$ | async)?.coverImage"
>
  <div jumbotron-title>{{ (group$ | async)?.name }}</div>
  <div jumbotron-text>
    <span class="f-lg">
      {{ groupCounter$ | async | number }}
    </span>
    acts of love
  </div>
</liow-jumbotron>

<div class="container container-pad">
  <div class="row">
    <div class="col-sm-4 col-md-3 col-sm-push-8 col-md-push-9 m-b-lg">
      <div class="well well-sm" *ngIf="(campaign$ | async) && (isUserAn$(memberOfGroup, authUser$, group$) | async)">
        <h5 class="text-center">
          Current Campaign<br>
          <small>
            <span class="f-lg">

            </span>
            acts of love
          </small>
        </h5>

        <div [ngSwitch]="isUserAn$(adminOfGroup, authUser$, group$) | async">
          <!-- Show buttons with publish/unpublish menu for admins -->
          <div *ngSwitchCase="true">
            <div
              class="btn-group btn-block"
              *ngFor="let item of (campaign$ | async)?.deeds; trackBy: item?._id"
              dropdown
            >
              <a
                [routerLink]="['/d', item.deed.urlTitle]"
                class="btn"
                [class.btn-primary]="item.published"
                [class.btn-default]="!item.published"
                [class.btn-lg]="isCurrentDeed(item.deed) | async"
              >
                {{ item.deed.title }}
              </a>
              <button
                type="button"
                class="btn"
                [class.btn-primary]="item.published"
                [class.btn-default]="!item.published"
                [class.btn-lg]="isCurrentDeed(item.deed) | async"
                dropdownToggle
              >
                <span class="caret"></span>
                <span class="sr-only">Toggle Dropdown</span>
              </button>
              <ul class="dropdown-menu-right" dropdownMenu>
                <li *ngIf="!item.published">
                  <a (click)="setPublished(campaign$, item.deed, true); $event.preventDefault()" href>
                    <i class="fa fa-fw fa-thumbs-up"></i>
                    Publish
                  </a>
                </li>
                <li *ngIf="item.published">
                  <a (click)="setPublished(campaign$, item.deed, false); $event.preventDefault()" href>
                    <i class="fa fa-fw fa-thumbs-down"></i>
                    Unpublish
                  </a>
                </li>
              </ul>
            </div>

            <hr>
            <button
              type="button"
              class="btn btn-default btn-block"
              (click)="openCampaignEditModal(group$, campaign$)"
            >
              <i class="fa fa-fw fa-edit"></i>
              Update campaign
            </button>
            <button
              type="button"
              class="btn btn-default btn-block"
              (click)="finishCampaign(campaign$)"
            >
              <i class="fa fa-fw fa-flag-checkered"></i>
              Finish campaign
            </button>
          </div>

          <!-- Show a normal button for non-admins -->
          <div *ngSwitchCase="false">
            <a
              *ngFor="let item of (campaign$ | async)?.deeds; trackBy: item?._id"
              [routerLink]="['/d', item.deed.urlTitle]"
              class="btn btn-block"
              [class.btn-primary]="item.published"
              [class.btn-default]="!item.published"
              [class.btn-lg]="isCurrentDeed(item.deed) | async"
            >
              {{ item.deed.title }}
            </a>
          </div>
        </div>
      </div>

      <button
        type="button"
        class="btn btn-primary btn-block btn-lg"
        (click)="joinGroup(authUser$, group$)"
        *ngIf="(isAuthenticated$ | async) && !(isUserAn$(memberOfGroup, authUser$, group$) | async)"
      >
        <i class="fa fa-fw fa-users"></i>
        Join us
      </button>
      <button
        type="button"
        class="btn btn-primary btn-block btn-lg"
        (click)="openLoginModal()"
        *ngIf="!(isAuthenticated$ | async)"
      >
        <i class="fa fa-fw fa-users"></i>
        Login &amp; Join us
      </button>
      <button
        type="button"
        class="btn btn-default btn-block"
        (click)="openCampaignEditModal(group$)"
        *ngIf="!(campaign$ | async) && (isUserAn$(adminOfGroup, authUser$, group$) | async)"
      >
        <i class="fa fa-fw fa-bullhorn"></i>
        Setup campaign
      </button>
      <button
        type="button"
        class="btn btn-default btn-block"
        (click)="openGroupEditModal(group$)"
        *ngIf="isUserAn$(adminOfGroup, authUser$, group$) | async"
      >
        <i class="fa fa-fw fa-edit"></i>
        Update group
      </button>
      <button
        type="button"
        class="btn btn-default btn-block"
        (click)="leaveGroup(authUser$, group$)"
        *ngIf="isUserAn$(memberOfGroup, authUser$, group$) | async"
      >
        <i class="fa fa-fw fa-sign-out"></i>
        Leave group
      </button>
    </div>

    <div class="col-sm-8 col-md-9 col-sm-pull-4 col-md-pull-3">
      <alert
        type="info"
        [dismissible]="true"
        *ngIf="!(campaign$ | async) && (isUserAn$(adminOfGroup, authUser$, group$) | async)"
      >
        You haven't got an active campaign, would you like to set one up now?&nbsp;
        <button
          type="button"
          class="btn btn-info btn-inline m-t-xxs p-xs"
          (click)="openCampaignEditModal(group$)"
        >
          Setup Campaign
        </button>
      </alert>

      <tabset type="pills">
        <tab
          [active]="(currentTab$ | async) === tabs.Welcome"
          (select)="setCurrentTab(tabs.Welcome)"
        >
          <template tabHeading>
            <i class="fa fa-fw fa-commenting"></i>
            Welcome
          </template>

          <blockquote *ngIf="(group$ | async)?.welcomeMessage">
            <ui-marked [content]="(group$ | async)?.welcomeMessage"></ui-marked>
          </blockquote>

          <div *ngIf="!(group$ | async)?.welcomeMessage">
            <h2>
              The Love is our Weapon Campaign is a youth movement that exists to
              change cities through the love of Jesus by doing strategic practical
              acts of love.
            </h2>
            <p>
              Thousands of people, doing thousands of acts of love, bringing
              change, value, healing and hope throughout cities and communities
              everywhere.
            </p>
          </div>
        </tab>

        <tab
          [active]="(currentTab$ | async) === tabs.Feed"
          (select)="setCurrentTab(tabs.Feed)"
        >
          <template tabHeading>
            <i class="fa fa-fw fa-list"></i>
            Activity Feed
          </template>

          <liow-feed
            [criteria]="{ group: (group$ | async)?._id }"
            *ngIf="(isAuthenticated$ | async) && (group$ | async)"
          ></liow-feed>

          <p *ngIf="!(isAuthenticated$ | async)">
            You must <a (click)="openLoginModal(); $event.preventDefault()" href>login</a>
            to see {{ (group$ | async)?.name }}'s Activity Feed.
          </p>
        </tab>
      </tabset>
    </div>
  </div>
</div>

<div
  bsModal
  #confirmModal="bs-modal"
  class="modal fade"
  tabindex="-1"
  role="dialog"
  aria-labelledby="Confirmation"
  aria-hidden="true"
  [config]="{ backdrop: 'static', keyboard: false }"
>
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-body">
        <p [innerHTML]="confirmModalContent"></p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" (click)="closeConfirmation(false)">
          Cancel
        </button>
        <button type="button" class="btn btn-primary" (click)="closeConfirmation(true)">
          OK
        </button>
      </div>
    </div>
  </div>
</div>
