box: node:6

build:
  steps:
    - script:
      name: install yarn
      code: npm install -g yarn

    - script:
      name: set yarn cache
      code: export YARN_CACHE=$WERCKER_CACHE_DIR/yarn

    - script:
      name: install dependencies
      code: HOME=$YARN_CACHE yarn

    - script:
      name: lint, test and build
      code: yarn build

deploy:
  steps:
    - s3sync:
      name: sync to S3
      key-id: $AWS_ACCESS_KEY_ID
      key-secret: $AWS_SECRET_KEY
      bucket-url: $S3_BUCKET_NAME
      source-dir: dist

    - dlapiduz/cf-invalidate:
      name: invalidate CloudFront cache
      key-id: $AWS_ACCESS_KEY_ID
      key-secret: $AWS_SECRET_KEY
      distribution-id: $CF_DISTRIBUTION_ID
      path: /*
